var sdk = require('./sdk');
var Client = require('node-rest-client').Client;

var endpoint = {
    developer: 'https://developers.decidir.com/api/v1'
}

examplePaymenteRequest();
//exampleHealthCheck();
//exampleInfoPayments();
//exampleRefunds();

function examplePaymenteRequest() {

    var args = {
        data: {
            card_number: "4507990000004905",
            card_expiration_month: "08",
            card_expiration_year: "20",
            security_code: "123",
            card_holder_name: "John Doe",
            card_holder_identification: {
                type: "dni",
                number: "25123456"
            }
        },
        headers: {
            "apikey": "e9cdb99fff374b5f91da4480c8dca741",
            "Content-Type": "application/json",
            "Cache-Control": ""
        }
    };

    var url = endpoint.developer;
    var postRequest = function(url, args, callback) {
        var client = new Client();
        client.post(endpoint.developer + "/tokens", args, function(data, response) {

            return callback(data.id);
            if (Buffer.isBuffer(data)) {
                data = JSON.parse(data.toString('utf8'));
                console.log(response);
            }
        });
    }

    postRequest(url, args, function(response) {
        token = response;
        var args = {
            data: {
                site_transaction_id: "asxdss2",
                token: token,
                payment_method_id: 1,
                bin: "450799",
                amount: 2000,
                currency: "ARS",
                installments: 1,
                description: "",
                payment_type: "single",
                sub_payments: []
            },
            headers: {
                'apikey': "92b71cf711ca41f78362a7134f87ff65",
                'Content-Type': "application/json"
            }
        };

        sdk.payment(args, function(result, err) {
            console.log("-------------------***-------------------");
            console.log("sendPaymentRequest result:");
            console.log(result);
            console.log("-------------------***-------------------");
            console.log("sendPaymentRequest error:");
            console.log(err);
            console.log("-------------------***-------------------");
        });

    });
}

function exampleHealthCheck() {

    var args = {
        headers: {
            "apikey": "e9cdb99fff374b5f91da4480c8dca741",
            "Content-Type": "application/json",
            "Cache-Control": "no-cache"
        }
    };

    sdk.healthcheck(args, function(result, err) {
        console.log("-------------------***-------------------");
        console.log("healthcheck result:");
        console.log(result);
        console.log("-------------------***-------------------");
        console.log("healthcheck error:");
        console.log(err);
        console.log("-------------------***-------------------");
    });

};

function exampleGetPayments() {

    var args = {
        headers: {
            "apikey": "e9cdb99fff374b5f91da4480c8dca741",
            "Content-Type": "application/json",
            "Cache-Control": "no-cache"
        }
    };

    sdk.healthcheck(args, function(result, err) {
        console.log("-------------------***-------------------");
        console.log("healthcheck result:");
        console.log(result);
        console.log("-------------------***-------------------");
        console.log("healthcheck error:");
        console.log(err);
        console.log("-------------------***-------------------");
    });

};

function exampleInfoPayments() {

    var args = {
        headers: {
            "apikey": "92b71cf711ca41f78362a7134f87ff65",
            "Content-Type": "application/json",
            "Cache-Control": ""
        }
    };

    sdk.infoPayments(args, function(result, err) {
        console.log("-------------------***-------------------");
        console.log("infoPayments result:");
        console.log(result);
        console.log("-------------------***-------------------");
        console.log("infoPayments error:");
        console.log(err);
        console.log("-------------------***-------------------");
    });

};


function exampleRefunds() {

    var args = {
        headers: {
            "apikey": "92b71cf711ca41f78362a7134f87ff65",
            "Content-Type": "application/json",
            "Cache-Control": ""
        }
    };

    sdk.refunds(args, function(result, err) {
        console.log("-------------------***-------------------");
        console.log("refunds result:");
        console.log(result.toString());
        console.log("-------------------***-------------------");
        console.log("refunds error:");
        console.log(err);
        console.log("-------------------***-------------------");
    });

};
